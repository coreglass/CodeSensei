# Code Sensei - OpenCode ç‰ˆæœ¬æµ‹è¯•æŒ‡å—

## âœ… å·²å®Œæˆçš„é›†æˆ

### 1. åç«¯æ”¹åŠ¨
- âœ… åˆ›å»ºäº† OpenCode HTTP å®¢æˆ·ç«¯ (`src-tauri/src/opencode.rs`)
- âœ… åˆ›å»ºäº†é…ç½®ç®¡ç†æ¨¡å— (`src-tauri/src/config.rs`)
- âœ… ç§»é™¤äº† Claude Agent ä¾èµ–
- âœ… æ›´æ–°äº† AI åŠŸèƒ½ï¼Œä½¿ç”¨ OpenCode Server

### 2. å‰ç«¯æ”¹åŠ¨
- âœ… æ›´æ–°äº†è®¾ç½®å¯¹è¯æ¡†ä¸º OpenCode é…ç½®ç•Œé¢
- âœ… æ·»åŠ äº†æµ‹è¯•è¿æ¥åŠŸèƒ½
- âœ… æ·»åŠ äº† Provider å’Œ Model é…ç½®
- âœ… ç§»é™¤äº† Claude API Key é…ç½®

### 3. ä¾èµ–æ¸…ç†
- âœ… ç§»é™¤äº† `@anthropic-ai/claude-agent-sdk`
- âœ… ç§»é™¤äº† Node.js æ’ä»¶ç³»ç»Ÿ
- âœ… ç®€åŒ–äº†æ„å»ºæµç¨‹

---

## ğŸš€ å¿«é€Ÿå¼€å§‹æµ‹è¯•

### æ­¥éª¤ 1ï¼šå®‰è£…å¹¶å¯åŠ¨ OpenCode Server

**å®‰è£… OpenCodeï¼š**
```bash
npm install -g @opencode/opencode
```

**å¯åŠ¨ Serverï¼š**
```bash
opencode serve --port 4096
```

Server å¯åŠ¨åï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
âœ“ OpenCode server is running
  - HTTP: http://127.0.0.1:4096
  - Docs: http://127.0.0.1:4096/doc
```

### æ­¥éª¤ 2ï¼šé…ç½® AI Provider

OpenCode éœ€è¦é…ç½® AI Provider æ‰èƒ½å·¥ä½œã€‚

**æ–¹å¼ä¸€ï¼šé€šè¿‡ OpenCode TUI é…ç½®**
1. åœ¨æ–°çš„ç»ˆç«¯çª—å£è¿è¡Œï¼š`opencode`
2. æŒ‰ `Ctrl+M` æ‰“å¼€æ¨¡å‹é€‰æ‹©å™¨
3. é€‰æ‹©ä½ çš„ Providerï¼ˆOpenAIã€Anthropic ç­‰ï¼‰
4. è¾“å…¥ API Key

**æ–¹å¼äºŒï¼šé€šè¿‡ API é…ç½®**
```bash
curl -X PUT http://localhost:4096/auth/openai \
  -H "Content-Type: application/json" \
  -d '{"apiKey": "sk-..."}'
```

### æ­¥éª¤ 3ï¼šè¿è¡Œ Code Sensei

**æ–¹å¼ä¸€ï¼šå¼€å‘æ¨¡å¼**
```bash
cd D:\code\CodeSensei
npm run tauri dev
```

**æ–¹å¼äºŒï¼šä½¿ç”¨å·²æ„å»ºçš„ exe**
```bash
.\src-tauri\target\release\code-sensei.exe
```

æˆ–è¿è¡Œå®‰è£…åŒ…ï¼š
```bash
.\src-tauri\target\release\bundle\nsis\Code Sensei_0.1.0_x64-setup.exe
```

### æ­¥éª¤ 4ï¼šé…ç½® Code Sensei

1. æ‰“å¼€ Code Sensei
2. ç‚¹å‡»å³ä¸Šè§’ **è®¾ç½®** æŒ‰é’®
3. å¡«å†™é…ç½®ï¼š
   - **Server åœ°å€**: `http://localhost:4096`
   - **ç”¨æˆ·å**: `opencode` (é»˜è®¤)
   - **å¯†ç **: ç•™ç©ºï¼ˆé™¤éä½ è®¾ç½®äº†å¯†ç ï¼‰
4. ç‚¹å‡» **æµ‹è¯•è¿æ¥**
   - åº”è¯¥æ˜¾ç¤º "âœ… è¿æ¥æˆåŠŸï¼OpenCode Server ç‰ˆæœ¬: ..."
5. é€‰æ‹© **Provider** å’Œ **æ¨¡å‹**ï¼ˆå¯é€‰ï¼‰
   - å¦‚æœç•™ç©ºï¼Œä½¿ç”¨ OpenCode çš„é»˜è®¤é…ç½®
6. ç‚¹å‡» **ä¿å­˜é…ç½®**

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### æµ‹è¯• 1ï¼šåˆ›å»ºé¡¹ç›®

1. ç‚¹å‡» **åˆ›å»ºæ–°é¡¹ç›®**
2. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - é¡¹ç›®åç§°ï¼š`Test Project`
   - æè¿°ï¼š`æµ‹è¯• OpenCode é›†æˆ`
   - æ ¹ç›®å½•ï¼šé€‰æ‹©ä¸€ä¸ªç©ºæ–‡ä»¶å¤¹
3. ç‚¹å‡» **åˆ›å»º**

### æµ‹è¯• 2ï¼šæ›´æ–°éœ€æ±‚æ–‡æ¡£

1. æ‰“å¼€åˆšåˆ›å»ºçš„é¡¹ç›®
2. åˆ‡æ¢åˆ° **éœ€æ±‚æ–‡æ¡£** æ¨¡å¼
3. è¾“å…¥ï¼š`åˆ›å»ºä¸€ä¸ªå¾…åŠäº‹é¡¹åº”ç”¨ï¼ŒåŒ…å«æ·»åŠ ã€åˆ é™¤ã€æ ‡è®°å®ŒæˆåŠŸèƒ½`
4. ç‚¹å‡» **å‘é€**

**é¢„æœŸç»“æœï¼š**
- âœ… æ˜¾ç¤ºè¿›åº¦æç¤º
- âœ… éœ€æ±‚æ–‡æ¡£è¢«ç”Ÿæˆ
- âœ… æ–‡æ¡£å†…å®¹åˆç†

### æµ‹è¯• 3ï¼šåˆ›å»ºæ–‡ä»¶

1. åˆ‡æ¢åˆ° **åˆ›å»ºæ–‡ä»¶** æ¨¡å¼
2. è¾“å…¥ï¼š`åˆ›å»ºä¸€ä¸ª index.html æ–‡ä»¶ï¼ŒåŒ…å«æ ‡é¢˜ "å¾…åŠäº‹é¡¹åˆ—è¡¨" å’Œä¸€ä¸ªç©ºåˆ—è¡¨`
3. ç‚¹å‡» **å‘é€**

**é¢„æœŸç»“æœï¼š**
- âœ… æ˜¾ç¤ºè¿›åº¦æç¤º
- âœ… æ–‡ä»¶è¢«åˆ›å»º
- âœ… æ–‡ä»¶å†…å®¹ç¬¦åˆè¦æ±‚
- âœ… æ–‡ä»¶æ ‘è‡ªåŠ¨åˆ·æ–°

### æµ‹è¯• 4ï¼šå¤šè½®å¯¹è¯

1. åˆ‡æ¢åˆ° **å¯¹è¯æ¨¡å¼**
2. è¾“å…¥ï¼š`è¿™ä¸ªé¡¹ç›®æœ‰å“ªäº›æ–‡ä»¶ï¼Ÿ`
3. AI åº”è¯¥èƒ½å›ç­”ä½ çš„é—®é¢˜

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ OpenCode Server æ—¥å¿—

åœ¨è¿è¡Œ `opencode serve` çš„ç»ˆç«¯ä¸­æŸ¥çœ‹å®æ—¶æ—¥å¿—ã€‚

### æŸ¥çœ‹ Code Sensei åç«¯æ—¥å¿—

è¿è¡Œå¼€å‘æ¨¡å¼æ—¶ï¼Œç»ˆç«¯ä¼šæ˜¾ç¤º Rust çš„ `println!` è¾“å‡ºï¼š
```
========== ä½¿ç”¨ OpenCode æ›´æ–°éœ€æ±‚æ–‡æ¡£ ==========
é¡¹ç›® ID: xxx
ç”¨æˆ·è¾“å…¥: xxx
OpenCode Server: http://localhost:4096
æ£€æŸ¥ OpenCode Server è¿æ¥...
Server ç‰ˆæœ¬: x.x.x
...
```

### å¸¸è§é—®é¢˜æ’æŸ¥

**é—®é¢˜ 1ï¼šè¿æ¥å¤±è´¥**
```
âŒ è¿æ¥å¤±è´¥: æ— æ³•è¿æ¥åˆ° OpenCode Server
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ OpenCode Server æ˜¯å¦è¿è¡Œ
   ```bash
   curl http://localhost:4096/global/health
   ```
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. ç¡®è®¤ç«¯å£å·æ­£ç¡®ï¼ˆé»˜è®¤ 4096ï¼‰

**é—®é¢˜ 2ï¼šAI å“åº”ä¸ºç©º**
```
AI è¿”å›äº†ç©ºå“åº”
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ AI Provider æ˜¯å¦é…ç½®æ­£ç¡®
2. ç¡®è®¤ API Key æœ‰æ•ˆ
3. åœ¨ OpenCode ä¸­æµ‹è¯•æ¨¡å‹æ˜¯å¦å¯ç”¨

**é—®é¢˜ 3ï¼šæƒé™é”™è¯¯**
```
æƒé™æ‹’ç»
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥é¡¹ç›®ç›®å½•æƒé™
2. ç¡®ä¿ç”¨æˆ·æœ‰è¯»å†™æƒé™
3. é¿å…ä½¿ç”¨ç³»ç»Ÿä¿æŠ¤ç›®å½•

---

## ğŸ“Š API ç«¯ç‚¹å‚è€ƒ

### å¥åº·æ£€æŸ¥
```bash
GET http://localhost:4096/global/health
Response: { "healthy": true, "version": "x.x.x" }
```

### åˆ›å»ºä¼šè¯
```bash
POST http://localhost:4096/session
Body: { "title": "Test Session" }
Response: { "id": "session-uuid", ... }
```

### å‘é€æ¶ˆæ¯
```bash
POST http://localhost:4096/session/{id}/message
Body: {
  "parts": [
    { "type": "text", "text": "Hello" }
  ]
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å¯é€‰çš„å¢å¼ºåŠŸèƒ½

1. **æµå¼è¾“å‡º**
   - ä½¿ç”¨ Server-Sent Events (SSE)
   - å®æ—¶æ˜¾ç¤º AI å“åº”

2. **å·¥å…·è°ƒç”¨å¯è§†åŒ–**
   - ç›‘å¬ OpenCode çš„å·¥å…·è°ƒç”¨
   - æ˜¾ç¤ºæ­£åœ¨è¯»å†™çš„æ–‡ä»¶

3. **ä¼šè¯å†å²**
   - ä¿å­˜å¯¹è¯å†å²
   - æ”¯æŒå¤šè½®å¯¹è¯

4. **Agent æ¨¡å¼**
   - ä½¿ç”¨ OpenCode çš„ Agent ç³»ç»Ÿ
   - æ”¯æŒä¸åŒåœºæ™¯çš„ä¸“ç”¨ agents

---

## ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®

### Windows
```
OpenCode é…ç½®: %USERPROFILE%/.opencode/config.json
Code Sensei é…ç½®: %USERPROFILE%/.config/CodeSensei/opencode-config.json
```

### macOS/Linux
```
OpenCode é…ç½®: ~/.opencode/config.json
Code Sensei é…ç½®: ~/.config/CodeSensei/opencode-config.json
```

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

### å®˜æ–¹æ–‡æ¡£
- [OpenCode æ–‡æ¡£](https://opencode.ai/docs/server/)
- [OpenCode GitHub](https://github.com/sst/opencode)

### æµ‹è¯•æ”¯æŒ
å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹ OpenCode Server æ—¥å¿—
2. æŸ¥çœ‹ Code Sensei åç«¯æ—¥å¿—
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. ç¡®è®¤é…ç½®æ­£ç¡®

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰
